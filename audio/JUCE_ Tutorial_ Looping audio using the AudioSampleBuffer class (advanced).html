<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0079)https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta name="generator" content="Doxygen 1.11.0">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JUCE: Tutorial: Looping audio using the AudioSampleBuffer class (advanced)</title>
<link href="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/jquery.js"></script>
<script type="text/javascript" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/dynsections.js"></script>
<link href="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/navtree.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/resize.js"></script>
<script type="text/javascript" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/cookie.js"></script>
<link href="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/search.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/searchdata.js"></script>
<script type="text/javascript" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/doxygen.css" rel="stylesheet" type="text/css">
<link rel="apple-touch-icon" sizes="180x180" href="https://docs.juce.com/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://docs.juce.com/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://docs.juce.com/favicons/favicon-16x16.png">
<link rel="manifest" href="https://docs.juce.com/favicons/site.webmanifest">
<link rel="mask-icon" href="https://docs.juce.com/favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://docs.juce.com/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-config" content="../favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="preload" as="style" href="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/css">
<link rel="stylesheet" href="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/css">
<script src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/script.js" site="COHIAING" defer=""></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <header id="_header-4-13" class="oxy-header-wrapper oxy-overlay-header oxy-header"><div id="_header_row-5-13" class="oxy-header-row"><div class="oxy-header-container"><div id="_header_left-6-13" class="oxy-header-left"><a id="link-7-13" class="ct-link" href="https://juce.com/"><img id="image-8-13" alt="JUCE Logo" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/JUCE-logo-horiz-ondark.png" class="ct-image"></a></div><div id="_header_center-9-13" class="oxy-header-center"></div><div id="_header_right-10-13" class="oxy-header-right"><nav id="_nav_menu-11-13" class="oxy-nav-menu oxy-nav-menu-dropdowns oxy-nav-menu-dropdown-arrow oxy-nav-menu-responsive-dropdowns"><div class="oxy-menu-toggle"><div class="oxy-nav-menu-hamburger-wrap"><div class="oxy-nav-menu-hamburger"><div class="oxy-nav-menu-hamburger-line"></div><div class="oxy-nav-menu-hamburger-line"></div><div class="oxy-nav-menu-hamburger-line"></div></div></div></div><div class="menu-main-menu-container"><ul id="menu-main-menu" class="oxy-nav-menu-list"><li id="menu-item-290" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-290"><a href="https://juce.com/juce/whats-new/">Discover</a>
    <ul class="sub-menu">
        <li id="menu-item-254" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-254"><a href="https://juce.com/juce/whats-new/">What's New</a></li>
        <li id="menu-item-252" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-252"><a href="https://juce.com/juce/features/">Features</a></li>
    </ul>
    </li>
    <li id="menu-item-291" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-291"><a href="https://juce.com/learn/documentation/">Learn</a>
    <ul class="sub-menu">
        <li id="menu-item-241" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-241"><a href="https://juce.com/learn/documentation/">Documentation</a></li>
        <li id="menu-item-240" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-240"><a href="https://juce.com/learn/tutorials/">Tutorials</a></li>
        <li id="menu-item-275" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-275"><a href="https://juce.com/stories/">Made with JUCE</a></li>
        <li id="menu-item-242" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-242"><a href="https://juce.com/resources/">Resources</a></li>
    </ul>
    </li>
    <li id="menu-item-230" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-230"><a href="https://forum.juce.com/">Forum</a></li>
    </ul></div></nav><a id="link-28-13" class="ct-link" href="https://account.juce.com/account/dashboard" target="_self"><div id="fancy_icon-27-13" class="ct-fancy-icon"><svg id="svg-fancy_icon-27-13"><use xlink:href="#FontAwesomeicon-user-circle"></use></svg></div></a><a id="link_button-23-13" class="ct-link-button " href="https://juce.com/get-juce/">Get JUCE</a></div></div></div></header>
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1"><defs><symbol id="FontAwesomeicon-user-circle" viewBox="0 0 28 28"><title>user-circle</title><path d="M23.797 20.922c-0.406-2.922-1.594-5.516-4.25-5.875-1.375 1.5-3.359 2.453-5.547 2.453s-4.172-0.953-5.547-2.453c-2.656 0.359-3.844 2.953-4.25 5.875 2.172 3.063 5.75 5.078 9.797 5.078s7.625-2.016 9.797-5.078zM20 10c0-3.313-2.688-6-6-6s-6 2.688-6 6 2.688 6 6 6 6-2.688 6-6zM28 14c0 7.703-6.25 14-14 14-7.734 0-14-6.281-14-14 0-7.734 6.266-14 14-14s14 6.266 14 14z"></path></symbol></defs></svg>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            jQuery('body').on('click', '.oxy-menu-toggle', function() {
                jQuery(this).parent('.oxy-nav-menu').toggleClass('oxy-nav-menu-open');
                jQuery('body').toggleClass('oxy-nav-menu-prevent-overflow');
                jQuery('html').toggleClass('oxy-nav-menu-prevent-overflow');
            });
            var selector = '.oxy-nav-menu-open .menu-item a[href*="#"]';
            jQuery('body').on('click', selector, function(){
                jQuery('.oxy-nav-menu-open').removeClass('oxy-nav-menu-open');
                jQuery('body').removeClass('oxy-nav-menu-prevent-overflow');
                jQuery('html').removeClass('oxy-nav-menu-prevent-overflow');
                jQuery(this).click();
            });
        });
    </script>
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="https://docs.juce.com/master/index.html"><span>Tags</span></a></li>
      <li><a href="https://docs.juce.com/master/topics.html"><span>JUCE&nbsp;Modules</span></a></li>
      <li><a href="https://docs.juce.com/master/classes.html"><span>Alphabetical</span></a></li>
      <li><a href="https://juce.com/learn/tutorials"><span>Tutorials</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" tabindex="0">&nbsp;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/close.svg" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" onkeydown="return searchBox.OnSearchSelectKey(event)" tabindex="0">
<a class="SelectItem" onclick="searchBox.OnSelectItem(0)" href="javascript:void(0)"><span class="SelectionMark">•</span>All</a><a class="SelectItem" onclick="searchBox.OnSelectItem(1)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" onclick="searchBox.OnSelectItem(2)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" onclick="searchBox.OnSelectItem(3)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" onclick="searchBox.OnSelectItem(4)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" onclick="searchBox.OnSelectItem(5)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" onclick="searchBox.OnSelectItem(6)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" onclick="searchBox.OnSelectItem(7)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" onclick="searchBox.OnSelectItem(8)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" onclick="searchBox.OnSelectItem(9)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" onclick="searchBox.OnSelectItem(10)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Macros</a><a class="SelectItem" onclick="searchBox.OnSelectItem(11)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Modules</a><a class="SelectItem" onclick="searchBox.OnSelectItem(12)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content" style="height: 807.891px;">
<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial: Looping audio using the AudioSampleBuffer class (advanced)</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_getting_started">Getting started</a></li>
<li class="level1"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_demo_project">The demo project</a></li>
<li class="level1"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_thread_safe_techniques">Thread-safe techniques</a><ul><li class="level2"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_reference_counted_objects">Reference-counted objects</a></li>
<li class="level2"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_background_thread">Implementing the background thread</a></li>
<li class="level2"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_opening_the_file">Opening the file</a></li>
<li class="level2"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_playing_the_buffer">Playing the buffer</a></li>
</ul>
</li>
<li class="level1"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_reading_the_audio_background">Reading the audio on the background thread</a><ul><li class="level2"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_passing_the_filepath">Passing the file path to the background thread</a></li>
<li class="level2"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_access_path_background">Accessing the path from the background thread</a></li>
</ul>
</li>
<li class="level1"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_summary">Summary</a></li>
<li class="level1"><a href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer_advanced.html#tutorial_looping_audio_sample_buffer_advanced_see_also">See also</a></li>
</ul>
</div>
<div class="textblock"><p>This tutorial shows how to play and loop audio stored in an <a class="el" href="https://docs.juce.com/master/group__juce__audio__basics-buffers.html#gab339ebab0d3b10c91c0d47c8fd2e50d2">AudioSampleBuffer</a> object using thread-safe techniques. A technique for loading the audio data on a background thread is also introduced.</p>
<p><span class="headerlabel">Level:</span> Advanced</p>
<p><span class="headerlabel">Platforms:</span> Windows , macOS , Linux</p>
<p><span class="headerlabel">Classes:</span> <a class="el" href="https://docs.juce.com/master/classReferenceCountedObject.html" title="A base class which provides methods for reference-counting.">ReferenceCountedObject</a>, <a class="el" href="https://docs.juce.com/master/classReferenceCountedArray.html" title="Holds a list of objects derived from ReferenceCountedObject, or which implement basic reference-count...">ReferenceCountedArray</a>, <a class="el" href="https://docs.juce.com/master/classThread.html" title="Encapsulates a thread.">Thread</a>, <a class="el" href="https://docs.juce.com/master/classAudioBuffer.html" title="A multi-channel buffer containing floating point audio samples.">AudioBuffer</a></p>
<h1><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_getting_started"></a>
Getting started</h1>
<p>This tutorial leads on from <a class="el" href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer.html">Tutorial: Looping audio using the AudioSampleBuffer class</a>. If you haven't done so already, you should read that tutorial first.</p>
<p>Download the demo project for this tutorial here: <a href="https://docs.juce.com/tutorials/PIPs/LoopingAudioSampleBufferAdvancedTutorial.zip">PIP</a> | <a href="https://docs.juce.com/tutorials/ZIPs/LoopingAudioSampleBufferAdvancedTutorial.zip">ZIP</a> . Unzip the project and open the first header file in the Projucer.</p>
<p>If you need help with this step, see <a class="el" href="https://docs.juce.com/master/tutorial_new_projucer_project.html">Tutorial: Projucer Part 1: Getting started with the Projucer</a>.</p>
<h1><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_demo_project"></a>
The demo project</h1>
<p>The demo project implements similar behaviour to the demo project from <a class="el" href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer.html">Tutorial: Looping audio using the AudioSampleBuffer class</a>. It allows the user to open an audio file that is loaded into a buffer and played in a loop. One major difference in this tutorial is that the audio system is kept running, rather than shutting it down each time we browse for a file. This is achieved by using some helpful classes for communicating between threads in a thread-safe manner.</p>
<h1><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_thread_safe_techniques"></a>
Thread-safe techniques</h1>
<p>You should recall in <a class="el" href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer.html">Tutorial: Looping audio using the AudioSampleBuffer class</a> how we solved the potential problem of the audio thread and the message thread accessing potentially incomplete or corrupted data. Just before we browsed for a file we shut down the audio system. Then, once a file was selected, we opened the file and restarted the audio system. This is clearly an impractical and cumbersome method in a real application!</p>
<h2><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_reference_counted_objects"></a>
Reference-counted objects</h2>
<p>The <a class="el" href="https://docs.juce.com/master/classReferenceCountedObject.html" title="A base class which provides methods for reference-counting.">ReferenceCountedObject</a> class is a useful tool for passing messages and data between threads. Here, we store our <a class="el" href="https://docs.juce.com/master/group__juce__audio__basics-buffers.html#gab339ebab0d3b10c91c0d47c8fd2e50d2">AudioSampleBuffer</a> object and the playback position in a <a class="el" href="https://docs.juce.com/master/classReferenceCountedObject.html" title="A base class which provides methods for reference-counting.">ReferenceCountedObject</a> class. To help with debugging, and to help illustrate how the class works, we also include <code class="project_code">name</code> member (although this isn't strictly necessary for the class to function):</p>
<div class="fragment"><div class="line">    <span class="keyword">class </span>ReferenceCountedBuffer  : <span class="keyword">public</span> juce::ReferenceCountedObject</div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        <span class="keyword">typedef</span> juce::ReferenceCountedObjectPtr&lt;ReferenceCountedBuffer&gt; Ptr;</div>
<div class="line"> </div>
<div class="line">        ReferenceCountedBuffer (<span class="keyword">const</span> juce::String&amp; nameToUse,</div>
<div class="line">                                <span class="keywordtype">int</span> numChannels,</div>
<div class="line">                                <span class="keywordtype">int</span> numSamples)</div>
<div class="line">            : <a class="code hl_variable" href="https://docs.juce.com/master/group__juce__audio__plugin__client-Unity.html#ga010e50efcb9d6d393b9414f09f368dbc">name</a> (nameToUse),</div>
<div class="line">              buffer (numChannels, numSamples)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_define" href="https://docs.juce.com/master/group__juce__core-system.html#ga679635952a5d2eb25f3b31398f0fcc25">DBG</a> (juce::String (<span class="stringliteral">"Buffer named '"</span>) + <a class="code hl_variable" href="https://docs.juce.com/master/group__juce__audio__plugin__client-Unity.html#ga010e50efcb9d6d393b9414f09f368dbc">name</a> + <span class="stringliteral">"' constructed. numChannels = "</span> + juce::String (numChannels) + <span class="stringliteral">", numSamples = "</span> + juce::String (numSamples));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ~ReferenceCountedBuffer()</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_define" href="https://docs.juce.com/master/group__juce__core-system.html#ga679635952a5d2eb25f3b31398f0fcc25">DBG</a> (juce::String (<span class="stringliteral">"Buffer named '"</span>) + <a class="code hl_variable" href="https://docs.juce.com/master/group__juce__audio__plugin__client-Unity.html#ga010e50efcb9d6d393b9414f09f368dbc">name</a> + <span class="stringliteral">"' destroyed"</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        juce::AudioSampleBuffer* getAudioSampleBuffer()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> &amp;buffer;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> position = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        juce::String <a class="code hl_variable" href="https://docs.juce.com/master/group__juce__audio__plugin__client-Unity.html#ga010e50efcb9d6d393b9414f09f368dbc">name</a>;</div>
<div class="line">        juce::AudioSampleBuffer buffer;</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="https://docs.juce.com/master/group__juce__core-system.html#ga851b02724a8158a7f746c66b5758b3dd">JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR</a> (ReferenceCountedBuffer)</div>
<div class="line">    };</div>
</div><!-- fragment --><p>The <code class="code">typedef</code> at the top of the class is an important part in implementing a <a class="el" href="https://docs.juce.com/master/classReferenceCountedObject.html" title="A base class which provides methods for reference-counting.">ReferenceCountedObject</a> subclass. Rather than storing our <code class="project_code">ReferenceCountedBuffer</code> object in a raw pointer, we store it in a <code class="project_code">ReferenceCountedBuffer::Ptr</code> type. It is this that manages the reference count of the object (incrementing and decrementing as necessary) and its lifetime (deleting the object when the reference count reaches zero). We can also store an array of <code class="project_code">ReferenceCountedBuffer</code> objects using the <a class="el" href="https://docs.juce.com/master/classReferenceCountedArray.html" title="Holds a list of objects derived from ReferenceCountedObject, or which implement basic reference-count...">ReferenceCountedArray</a> class.</p>
<p>In our <code class="project_code">MainContentComponent</code> class we store both an array and a single instance:</p>
<div class="fragment"><div class="line">    juce::SpinLock mutex;</div>
<div class="line">    juce::ReferenceCountedArray&lt;ReferenceCountedBuffer&gt; buffers;</div>
<div class="line">    ReferenceCountedBuffer::Ptr currentBuffer;</div>
</div><!-- fragment --><p>The <code class="project_code">buffers</code> member keeps hold of our buffers in the array until we are absolutely sure they are no longer needed by the audio thread. The <code class="project_code">currentBuffer</code> member holds the currently selected buffer.</p>
<h2><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_background_thread"></a>
Implementing the background thread</h2>
<p>Our <code class="project_code">MainContentComponent</code> class inherits from the <a class="el" href="https://docs.juce.com/master/classThread.html" title="Encapsulates a thread.">Thread</a> class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MainContentComponent   : <span class="keyword">public</span> juce::AudioAppComponent,</div>
<div class="line">                               <span class="keyword">private</span> juce::Thread</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
</div><!-- fragment --><p>This is used to implement our background thread. Our overridden <a class="el" href="https://docs.juce.com/master/classThread.html#aae90dfabab3e1776cf01a26e7ee3a620" title="Must be implemented to perform the thread&#39;s actual code.">Thread::run()</a> function is as follows:</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> run()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">while</span> (! threadShouldExit())</div>
<div class="line">        {</div>
<div class="line">            checkForBuffersToFree();</div>
<div class="line">            wait (500);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Here, we check whether there are any buffers to be freed, then our thread waits for 500ms or to be woken up (using the <a class="el" href="https://docs.juce.com/master/classThread.html#a0b4d5a1ffaa35cc13f323a0524012a2b" title="Wakes up the thread.">Thread::notify()</a> function). Essentially, this means that the check will occur at least every 500ms. The <code class="project_code">checkForBuffersToFree()</code> function searches through our <code class="project_code">buffers</code> array to see if any buffers can be freed:</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> checkForBuffersToFree()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = buffers.size(); --i &gt;= 0;)                           <span class="comment">// [1]</span></div>
<div class="line">        {</div>
<div class="line">            ReferenceCountedBuffer::Ptr buffer (buffers.getUnchecked (i)); <span class="comment">// [2]</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (buffer-&gt;getReferenceCount() == 2)                          <span class="comment">// [3]</span></div>
<div class="line">                buffers.remove (i);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><ul>
<li><span class="comment">[1]</span> : It is useful to remember to iterate over the array in reverse in these situations. It is easier to avoid corrupting the array index access if we remove items as we iterate over the array.</li>
<li><span class="comment">[2]</span> : This retains a copy of a buffer at the specified index.</li>
<li><span class="comment">[3]</span> : If the reference count at this point is equal to 2 then we know that the audio thread can't be using the buffer and we can remove it from the array. One of these two references will be in the <code class="project_code">buffers</code> and the other will be in the local <code class="project_code">buffer</code> variable. The removed buffer will delete itself as the <code class="project_code">buffer</code> variable goes out of scope (as this will be the last remaining reference).</li>
</ul>
<p>Of course, we need to start the thread as our application starts, which we do in our <code class="project_code">MainContentComponent</code> constructor:</p>
<div class="fragment"><div class="line">        startThread();</div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_opening_the_file"></a>
Opening the file</h2>
<p>Our <code class="project_code">openButtonClicked()</code> function is similar to the <code class="project_code">openButtonClicked()</code> function from <a class="el" href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer.html">Tutorial: Looping audio using the AudioSampleBuffer class</a> with some minor differences:</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> openButtonClicked()</div>
<div class="line">    {</div>
<div class="line">        chooser = std::make_unique&lt;juce::FileChooser&gt; (<span class="stringliteral">"Select a Wave file shorter than 2 seconds to play..."</span>,</div>
<div class="line">                                                       juce::File{},</div>
<div class="line">                                                       <span class="stringliteral">"*.wav"</span>);</div>
<div class="line">        <span class="keyword">auto</span> chooserFlags = juce::FileBrowserComponent::openMode</div>
<div class="line">                          | juce::FileBrowserComponent::canSelectFiles;</div>
<div class="line"> </div>
<div class="line">        chooser-&gt;launchAsync (chooserFlags, [<span class="keyword">this</span>] (<span class="keyword">const</span> juce::FileChooser&amp; fc)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> file = fc.getResult();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (file == juce::File{})</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            std::unique_ptr&lt;juce::AudioFormatReader&gt; reader (formatManager.createReaderFor (file));</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (reader != <span class="keyword">nullptr</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">auto</span> duration = (float) reader-&gt;lengthInSamples / reader-&gt;sampleRate;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (duration &lt; 2)</div>
<div class="line">                {</div>
<div class="line">                    ReferenceCountedBuffer::Ptr newBuffer = <span class="keyword">new</span> ReferenceCountedBuffer (file.getFileName(),</div>
<div class="line">                                                                                        (<span class="keywordtype">int</span>) reader-&gt;numChannels,</div>
<div class="line">                                                                                        (<span class="keywordtype">int</span>) reader-&gt;lengthInSamples);</div>
<div class="line"> </div>
<div class="line">                    reader-&gt;read (newBuffer-&gt;getAudioSampleBuffer(), 0, (<span class="keywordtype">int</span>) reader-&gt;lengthInSamples, 0, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">                    {</div>
<div class="line">                        <span class="keyword">const</span> juce::SpinLock::ScopedLockType lock (mutex);</div>
<div class="line">                        currentBuffer = newBuffer;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    buffers.add (newBuffer);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// handle the error that the file is 2 seconds or longer..</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        });</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Here are the differences:</p><ul>
<li>Allocate a new instance of our <code class="project_code">ReferenceCountedBuffer</code> class.</li>
<li>Read the audio data into the <a class="el" href="https://docs.juce.com/master/group__juce__audio__basics-buffers.html#gab339ebab0d3b10c91c0d47c8fd2e50d2">AudioSampleBuffer</a> object that it contains.</li>
<li>Make it the current buffer.</li>
<li>Add it to our array of buffers.</li>
</ul>
<p>To clear the current buffer we can just set its value to <code class="code">nullptr</code> :</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> clearButtonClicked()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> juce::SpinLock::ScopedLockType lock (mutex);</div>
<div class="line">        currentBuffer = <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_playing_the_buffer"></a>
Playing the buffer</h2>
<p>Our <code class="project_code">getNextAudioBlock()</code> function is similar to the <code class="project_code">getNextAudioBlock()</code> function from <a class="el" href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer.html">Tutorial: Looping audio using the AudioSampleBuffer class</a> except we need to access our current <code class="project_code">ReferenceCountedBuffer</code> object and the <a class="el" href="https://docs.juce.com/master/group__juce__audio__basics-buffers.html#gab339ebab0d3b10c91c0d47c8fd2e50d2">AudioSampleBuffer</a> object it contains.</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> getNextAudioBlock (<span class="keyword">const</span> juce::AudioSourceChannelInfo&amp; bufferToFill)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keyword">auto</span> retainedCurrentBuffer = [&amp;]() -&gt; ReferenceCountedBuffer::Ptr               <span class="comment">// [4]</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> juce::SpinLock::ScopedTryLockType lock (mutex);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (lock.isLocked())</div>
<div class="line">                <span class="keywordflow">return</span> currentBuffer;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">        }();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (retainedCurrentBuffer == <span class="keyword">nullptr</span>)                                           <span class="comment">// [5]</span></div>
<div class="line">        {</div>
<div class="line">            bufferToFill.clearActiveBufferRegion();</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span>* currentAudioSampleBuffer = retainedCurrentBuffer-&gt;getAudioSampleBuffer(); <span class="comment">// [6]</span></div>
<div class="line">        <span class="keyword">auto</span> position = retainedCurrentBuffer-&gt;position;                                <span class="comment">// [7]</span></div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> numInputChannels = currentAudioSampleBuffer-&gt;getNumChannels();</div>
<div class="line">        <span class="keyword">auto</span> numOutputChannels = bufferToFill.buffer-&gt;getNumChannels();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> outputSamplesRemaining = bufferToFill.numSamples;</div>
<div class="line">        <span class="keyword">auto</span> outputSamplesOffset = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (outputSamplesRemaining &gt; 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> bufferSamplesRemaining = currentAudioSampleBuffer-&gt;getNumSamples() - position;</div>
<div class="line">            <span class="keyword">auto</span> samplesThisTime = juce::jmin (outputSamplesRemaining, bufferSamplesRemaining);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">auto</span> channel = 0; channel &lt; numOutputChannels; ++channel)</div>
<div class="line">            {</div>
<div class="line">                bufferToFill.buffer-&gt;copyFrom (channel,</div>
<div class="line">                                               bufferToFill.startSample + outputSamplesOffset,</div>
<div class="line">                                               *currentAudioSampleBuffer,</div>
<div class="line">                                               channel % numInputChannels,</div>
<div class="line">                                               position,</div>
<div class="line">                                               samplesThisTime);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            outputSamplesRemaining -= samplesThisTime;</div>
<div class="line">            outputSamplesOffset += samplesThisTime;</div>
<div class="line">            position += samplesThisTime;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (position == currentAudioSampleBuffer-&gt;getNumSamples())</div>
<div class="line">                position = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        retainedCurrentBuffer-&gt;position = position;                                     <span class="comment">// [8]</span></div>
<div class="line">    }</div>
</div><!-- fragment --><p>The important changes are:</p><ul>
<li><span class="comment">[4]</span> : We retain a copy of the <code class="project_code">currentBuffer</code> member. After this point in the function it doesn't matter if the <code class="project_code">currentBuffer</code> member is changed on another thread since we have taken a local copy. Note that we use a try lock here, so that the audio thread doesn't get stuck waiting to access the <code class="project_code">currentBuffer</code> in the case that another thread is currently modifying it.</li>
<li><span class="comment">[5]</span> : We output silence if the <code class="project_code">currentBuffer</code> member was null when we took a copy.</li>
<li><span class="comment">[6]</span> : We access the <a class="el" href="https://docs.juce.com/master/group__juce__audio__basics-buffers.html#gab339ebab0d3b10c91c0d47c8fd2e50d2">AudioSampleBuffer</a> object within the <code class="project_code">ReferenceCountedBuffer</code> object.</li>
<li><span class="comment">[7]</span> : We get the current playback position for the buffer.</li>
<li><span class="comment">[8]</span> : After modifying the current playback position, we store it back in the <code class="project_code">ReferenceCountedBuffer</code> object.</li>
</ul>
<p>This algorithm ensures that <code class="project_code">ReferenceCountedBuffer</code> objects aren't deleted on the the audio thread. It is not a good idea to allocate or free memory on the audio thread. The <code class="project_code">ReferenceCountedBuffer</code> objects will only be deleted on our background thread.</p>
<h1><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_reading_the_audio_background"></a>
Reading the audio on the background thread</h1>
<p>Our application still reads the audio data on the message thread. This is not ideal since this blocks the message thread and large files could take some time to load. In fact, we can also use our background thread to perform this task.</p>
<h2><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_passing_the_filepath"></a>
Passing the file path to the background thread</h2>
<p>First, add the following member to the <code class="project_code">MainContentComponent</code> class:</p>
<div class="fragment"><div class="line">    juce::CriticalSection pathMutex;</div>
<div class="line">    juce::String chosenPath;</div>
</div><!-- fragment --><p>Now change the <code class="project_code">openButtonClicked()</code> function to <em>swap</em> the full path of the file into this member. Swapping strings is not technically thread-safe, so we also need to take a lock to ensure that no other threads try to modify <code class="project_code">chosenPath</code> while this thread is using it.</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> openButtonClicked()</div>
<div class="line">    {</div>
<div class="line">        chooser = std::make_unique&lt;juce::FileChooser&gt; (<span class="stringliteral">"Select a Wave file shorter than 2 seconds to play..."</span>,</div>
<div class="line">                                                       juce::File{},</div>
<div class="line">                                                       <span class="stringliteral">"*.wav"</span>);</div>
<div class="line">        <span class="keyword">auto</span> chooserFlags = juce::FileBrowserComponent::openMode</div>
<div class="line">                          | juce::FileBrowserComponent::canSelectFiles;</div>
<div class="line"> </div>
<div class="line">        chooser-&gt;launchAsync (chooserFlags, [<span class="keyword">this</span>] (<span class="keyword">const</span> juce::FileChooser&amp; fc)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> file = fc.getResult();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (file == juce::File{})</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">auto</span> path = file.getFullPathName();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> juce::ScopedLock lock (pathMutex);</div>
<div class="line">                chosenPath.swapWith (path);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_enumvalue" href="https://docs.juce.com/master/namespacemidi__ci.html#a28764d5b14a19a8095f8658353aed19daa4510384236c8e83a0cf3b6d8b987aef">notify</a>();</div>
<div class="line">        });</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Here we also wake up the background thread since we are going to call a function on the background thread to open the file.</p>
<h2><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_access_path_background"></a>
Accessing the path from the background thread</h2>
<p>Our <code class="project_code">run()</code> function should be updated as follows:</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> run()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">while</span> (! threadShouldExit())</div>
<div class="line">        {</div>
<div class="line">            checkForPathToOpen();</div>
<div class="line">            checkForBuffersToFree();</div>
<div class="line">            wait (500);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>The <code class="project_code">checkForPathToOpen()</code> function checks the <code class="project_code">chosenPath</code> member by swapping it into a local variable. Again, swapping is not thread-safe, so we must take a lock before accessing <code class="project_code">chosenPath</code> .</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> checkForPathToOpen()</div>
<div class="line">    {</div>
<div class="line">        juce::String pathToOpen;</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> juce::ScopedLock lock (pathMutex);</div>
<div class="line">            pathToOpen.swapWith (chosenPath);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pathToOpen.isNotEmpty())</div>
<div class="line">        {</div>
<div class="line">            juce::File file (pathToOpen);</div>
<div class="line">            std::unique_ptr&lt;juce::AudioFormatReader&gt; reader (formatManager.createReaderFor (file));</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (reader.get() != <span class="keyword">nullptr</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">auto</span> duration = (float) reader-&gt;lengthInSamples / reader-&gt;sampleRate;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (duration &lt; 2)</div>
<div class="line">                {</div>
<div class="line">                    ReferenceCountedBuffer::Ptr newBuffer = <span class="keyword">new</span> ReferenceCountedBuffer (file.getFileName(),</div>
<div class="line">                                                                                        (<span class="keywordtype">int</span>) reader-&gt;numChannels,</div>
<div class="line">                                                                                        (<span class="keywordtype">int</span>) reader-&gt;lengthInSamples);</div>
<div class="line"> </div>
<div class="line">                    reader-&gt;read (newBuffer-&gt;getAudioSampleBuffer(), 0, (<span class="keywordtype">int</span>) reader-&gt;lengthInSamples, 0, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">                    {</div>
<div class="line">                        <span class="keyword">const</span> juce::SpinLock::ScopedLockType lock (mutex);</div>
<div class="line">                        currentBuffer = newBuffer;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    buffers.add (newBuffer);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// handle the error that the file is 2 seconds or longer..</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>If the <code class="project_code">pathToOpen</code> variable is an empty string then we know there isn't a new file to open. The remainder of the code in this function should be familiar to you.</p>
<p>Run the application again and it should still function correctly.</p>
<dl class="section note"><dt>Note</dt><dd>The final code for this section can be found in the <code class="filename">LoopingAudioSampleBufferAdvancedTutorial_02.h</code> file of the demo project.</dd></dl>
<h1><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_summary"></a>
Summary</h1>
<p>This tutorial has introduced some useful techniques for passing data between threads, especially in an audio application. After reading this tutorial you should be able to:</p>
<ul>
<li>Implement a subclass of the <a class="el" href="https://docs.juce.com/master/classReferenceCountedObject.html" title="A base class which provides methods for reference-counting.">ReferenceCountedObject</a> class.</li>
<li>Maintain the lifetime of a <a class="el" href="https://docs.juce.com/master/classReferenceCountedObject.html" title="A base class which provides methods for reference-counting.">ReferenceCountedObject</a> in a multi-threaded application.</li>
<li>Implement a background thread to perform tasks such as deleting objects that are no longer needed and performing file reading operations.</li>
</ul>
<h1><a class="anchor" id="tutorial_looping_audio_sample_buffer_advanced_see_also"></a>
See also</h1>
<ul>
<li><a class="el" href="https://docs.juce.com/master/tutorial_playing_sound_files.html">Tutorial: Build an audio player</a></li>
<li><a class="el" href="https://docs.juce.com/master/tutorial_processing_audio_input.html">Tutorial: Processing audio input</a></li>
<li><a class="el" href="https://docs.juce.com/master/tutorial_audio_thumbnail.html">Tutorial: Draw audio waveforms</a></li>
<li><a class="el" href="https://docs.juce.com/master/tutorial_looping_audio_sample_buffer.html">Tutorial: Looping audio using the AudioSampleBuffer class</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<section id="section-10-81" class=" ct-section juce-sitemap"><div class="ct-section-inner-wrap"><div id="div_block-11-81" class="ct-div-block"><div id="new_columns-12-81" class="ct-new-columns"><div id="div_block-13-81" class="ct-div-block"><h3 id="headline-15-81" class="ct-headline ">Purchase</h3><a id="link_text-17-81" class="ct-link-text" href="https://juce.com/get-juce/">Get JUCE</a><h3 id="headline-20-81" class="ct-headline mt-xlrg">Discover</h3><a id="link_text-21-81" class="ct-link-text" href="https://juce.com/juce/whats-new/" target="_self">What's New in JUCE</a><a id="link_text-22-81" class="ct-link-text" href="https://juce.com/juce/features/" target="_self">Features</a><h3 id="headline-25-81" class="ct-headline mt-xlrg">Learn</h3><a id="link_text-27-81" class="ct-link-text" href="https://juce.com/learn/documentation/">Documentaion</a><a id="link_text-26-81" class="ct-link-text" href="https://juce.com/learn/tutorials/">Tutorials</a><a id="link_text-24-81" class="ct-link-text" href="https://juce.com/stories/" target="_self">Made with JUCE</a><a id="link_text-29-127" class="ct-link-text" href="https://juce.com/resources/" target="_self">Resources</a></div><div id="div_block-14-81" class="ct-div-block"><h3 id="headline-28-81" class="ct-headline">Support</h3><a id="link_text-31-81" class="ct-link-text" href="https://forum.juce.com/" target="_self">JUCE Forum</a><a class="ct-link-text" href="https://juce.com/newsletter" target="_self">Newsletter</a><a id="link_text-30-127" class="ct-link-text" href="https://juce.com/archive/">Archive</a><h3 id="headline-32-81" class="ct-headline mt-xlrg">About</h3><a id="link_text-29-81" class="ct-link-text" href="https://juce.com/contact-us/">Contact Us</a><a id="link_text-34-81" class="ct-link-text" href="https://juce.com/juce-legal/">JUCE Legal</a><a id="link_text-30-81" class="ct-link-text" href="https://juce.com/get-juce">JUCE Licensing FAQ</a><h3 id="headline-33-81" class="ct-headline mt-xlrg">Events</h3><a id="link_text-35-81" class="ct-link-text" href="https://audio.dev/" target="_blank">Audio Developer Conference</a></div><div id="div_block-38-81" class="ct-div-block"></div></div></div></div></section>
<section id="section-13-13" class=" ct-section"><div class="ct-section-inner-wrap"><div id="new_columns-14-13" class="ct-new-columns"><div id="div_block-20-13" class="ct-div-block"><div id="_social_icons-22-13" class="oxy-social-icons"><a href="https://www.facebook.com/jucelibrary" target="_blank" class="oxy-social-icons-facebook"><svg><title>Visit our Facebook</title><use xlink:href="#oxy-social-icons-icon-facebook"></use></svg></a><a href="https://twitter.com/jucelibrary" target="_blank" class="oxy-social-icons-twitter"><svg><title>Visit our Twitter</title><use xlink:href="#oxy-social-icons-icon-twitter"></use></svg></a><a href="https://www.linkedin.com/company/juce-c-/" target="_blank" class="oxy-social-icons-linkedin"><svg><title>Visit our LinkedIn</title><use xlink:href="#oxy-social-icons-icon-linkedin"></use></svg></a><a href="https://www.youtube.com/c/JUCElibrary" target="_blank" class="oxy-social-icons-youtube"><svg><title>Visit our YouTube channel</title><use xlink:href="#oxy-social-icons-icon-youtube"></use></svg></a></div></div><div id="div_block-17-13" class="ct-div-block"><a id="link-18-13" class="ct-link" href="https://juce.com/"><img id="image-19-13" alt="JUCE Logo" src="./JUCE_ Tutorial_ Looping audio using the AudioSampleBuffer class (advanced)_files/JUCE-logo-horiz-ondark.png" class="ct-image"></a></div><div id="div_block-15-13" class="ct-div-block"><div id="text_block-32-13" class="ct-text-block">© Raw Material Software Limited</div></div></div></div></section>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
   <defs>
      <symbol id="oxy-social-icons-icon-linkedin" viewBox="0 0 32 32">
         <title>linkedin</title>
         <path d="M12 12h5.535v2.837h0.079c0.77-1.381 2.655-2.837 5.464-2.837 5.842 0 6.922 3.637 6.922 8.367v9.633h-5.769v-8.54c0-2.037-0.042-4.657-3.001-4.657-3.005 0-3.463 2.218-3.463 4.509v8.688h-5.767v-18z"></path>
         <path d="M2 12h6v18h-6v-18z"></path>
         <path d="M8 7c0 1.657-1.343 3-3 3s-3-1.343-3-3c0-1.657 1.343-3 3-3s3 1.343 3 3z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-facebook" viewBox="0 0 32 32">
         <title>facebook</title>
         <path d="M19 6h5v-6h-5c-3.86 0-7 3.14-7 7v3h-4v6h4v16h6v-16h5l1-6h-6v-3c0-0.542 0.458-1 1-1z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-pinterest" viewBox="0 0 32 32">
         <title>pinterest</title>
         <path d="M16 2.138c-7.656 0-13.863 6.206-13.863 13.863 0 5.875 3.656 10.887 8.813 12.906-0.119-1.094-0.231-2.781 0.050-3.975 0.25-1.081 1.625-6.887 1.625-6.887s-0.412-0.831-0.412-2.056c0-1.925 1.119-3.369 2.506-3.369 1.181 0 1.756 0.887 1.756 1.95 0 1.188-0.756 2.969-1.15 4.613-0.331 1.381 0.688 2.506 2.050 2.506 2.462 0 4.356-2.6 4.356-6.35 0-3.319-2.387-5.638-5.787-5.638-3.944 0-6.256 2.956-6.256 6.019 0 1.194 0.456 2.469 1.031 3.163 0.113 0.137 0.131 0.256 0.094 0.4-0.106 0.438-0.338 1.381-0.387 1.575-0.063 0.256-0.2 0.306-0.463 0.188-1.731-0.806-2.813-3.337-2.813-5.369 0-4.375 3.175-8.387 9.156-8.387 4.806 0 8.544 3.425 8.544 8.006 0 4.775-3.012 8.625-7.194 8.625-1.406 0-2.725-0.731-3.175-1.594 0 0-0.694 2.644-0.863 3.294-0.313 1.206-1.156 2.712-1.725 3.631 1.3 0.4 2.675 0.619 4.106 0.619 7.656 0 13.863-6.206 13.863-13.863 0-7.662-6.206-13.869-13.863-13.869z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-youtube" viewBox="0 0 32 32">
         <title>youtube</title>
         <path d="M31.681 9.6c0 0-0.313-2.206-1.275-3.175-1.219-1.275-2.581-1.281-3.206-1.356-4.475-0.325-11.194-0.325-11.194-0.325h-0.012c0 0-6.719 0-11.194 0.325-0.625 0.075-1.987 0.081-3.206 1.356-0.963 0.969-1.269 3.175-1.269 3.175s-0.319 2.588-0.319 5.181v2.425c0 2.587 0.319 5.181 0.319 5.181s0.313 2.206 1.269 3.175c1.219 1.275 2.819 1.231 3.531 1.369 2.563 0.244 10.881 0.319 10.881 0.319s6.725-0.012 11.2-0.331c0.625-0.075 1.988-0.081 3.206-1.356 0.962-0.969 1.275-3.175 1.275-3.175s0.319-2.587 0.319-5.181v-2.425c-0.006-2.588-0.325-5.181-0.325-5.181zM12.694 20.15v-8.994l8.644 4.513-8.644 4.481z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-rss" viewBox="0 0 32 32">
         <title>rss</title>
         <path d="M4.259 23.467c-2.35 0-4.259 1.917-4.259 4.252 0 2.349 1.909 4.244 4.259 4.244 2.358 0 4.265-1.895 4.265-4.244-0-2.336-1.907-4.252-4.265-4.252zM0.005 10.873v6.133c3.993 0 7.749 1.562 10.577 4.391 2.825 2.822 4.384 6.595 4.384 10.603h6.16c-0-11.651-9.478-21.127-21.121-21.127zM0.012 0v6.136c14.243 0 25.836 11.604 25.836 25.864h6.152c0-17.64-14.352-32-31.988-32z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-twitter" viewBox="0 0 32 32">
         <title>twitter</title>
         <path d="M32 7.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-instagram" viewBox="0 0 32 32">
         <title>instagram</title>
         <path d="M16 2.881c4.275 0 4.781 0.019 6.462 0.094 1.563 0.069 2.406 0.331 2.969 0.55 0.744 0.288 1.281 0.638 1.837 1.194 0.563 0.563 0.906 1.094 1.2 1.838 0.219 0.563 0.481 1.412 0.55 2.969 0.075 1.688 0.094 2.194 0.094 6.463s-0.019 4.781-0.094 6.463c-0.069 1.563-0.331 2.406-0.55 2.969-0.288 0.744-0.637 1.281-1.194 1.837-0.563 0.563-1.094 0.906-1.837 1.2-0.563 0.219-1.413 0.481-2.969 0.55-1.688 0.075-2.194 0.094-6.463 0.094s-4.781-0.019-6.463-0.094c-1.563-0.069-2.406-0.331-2.969-0.55-0.744-0.288-1.281-0.637-1.838-1.194-0.563-0.563-0.906-1.094-1.2-1.837-0.219-0.563-0.481-1.413-0.55-2.969-0.075-1.688-0.094-2.194-0.094-6.463s0.019-4.781 0.094-6.463c0.069-1.563 0.331-2.406 0.55-2.969 0.288-0.744 0.638-1.281 1.194-1.838 0.563-0.563 1.094-0.906 1.838-1.2 0.563-0.219 1.412-0.481 2.969-0.55 1.681-0.075 2.188-0.094 6.463-0.094zM16 0c-4.344 0-4.887 0.019-6.594 0.094-1.7 0.075-2.869 0.35-3.881 0.744-1.056 0.412-1.95 0.956-2.837 1.85-0.894 0.888-1.438 1.781-1.85 2.831-0.394 1.019-0.669 2.181-0.744 3.881-0.075 1.713-0.094 2.256-0.094 6.6s0.019 4.887 0.094 6.594c0.075 1.7 0.35 2.869 0.744 3.881 0.413 1.056 0.956 1.95 1.85 2.837 0.887 0.887 1.781 1.438 2.831 1.844 1.019 0.394 2.181 0.669 3.881 0.744 1.706 0.075 2.25 0.094 6.594 0.094s4.888-0.019 6.594-0.094c1.7-0.075 2.869-0.35 3.881-0.744 1.050-0.406 1.944-0.956 2.831-1.844s1.438-1.781 1.844-2.831c0.394-1.019 0.669-2.181 0.744-3.881 0.075-1.706 0.094-2.25 0.094-6.594s-0.019-4.887-0.094-6.594c-0.075-1.7-0.35-2.869-0.744-3.881-0.394-1.063-0.938-1.956-1.831-2.844-0.887-0.887-1.781-1.438-2.831-1.844-1.019-0.394-2.181-0.669-3.881-0.744-1.712-0.081-2.256-0.1-6.6-0.1v0z"></path>
         <path d="M16 7.781c-4.537 0-8.219 3.681-8.219 8.219s3.681 8.219 8.219 8.219 8.219-3.681 8.219-8.219c0-4.537-3.681-8.219-8.219-8.219zM16 21.331c-2.944 0-5.331-2.387-5.331-5.331s2.387-5.331 5.331-5.331c2.944 0 5.331 2.387 5.331 5.331s-2.387 5.331-5.331 5.331z"></path>
         <path d="M26.462 7.456c0 1.060-0.859 1.919-1.919 1.919s-1.919-0.859-1.919-1.919c0-1.060 0.859-1.919 1.919-1.919s1.919 0.859 1.919 1.919z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-facebook-blank" viewBox="0 0 32 32">
         <title>facebook-blank</title>
         <path d="M29 0h-26c-1.65 0-3 1.35-3 3v26c0 1.65 1.35 3 3 3h13v-14h-4v-4h4v-2c0-3.306 2.694-6 6-6h4v4h-4c-1.1 0-2 0.9-2 2v2h6l-1 4h-5v14h9c1.65 0 3-1.35 3-3v-26c0-1.65-1.35-3-3-3z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-rss-blank" viewBox="0 0 32 32">
         <title>rss-blank</title>
         <path d="M29 0h-26c-1.65 0-3 1.35-3 3v26c0 1.65 1.35 3 3 3h26c1.65 0 3-1.35 3-3v-26c0-1.65-1.35-3-3-3zM8.719 25.975c-1.5 0-2.719-1.206-2.719-2.706 0-1.488 1.219-2.712 2.719-2.712 1.506 0 2.719 1.225 2.719 2.712 0 1.5-1.219 2.706-2.719 2.706zM15.544 26c0-2.556-0.994-4.962-2.794-6.762-1.806-1.806-4.2-2.8-6.75-2.8v-3.912c7.425 0 13.475 6.044 13.475 13.475h-3.931zM22.488 26c0-9.094-7.394-16.5-16.481-16.5v-3.912c11.25 0 20.406 9.162 20.406 20.413h-3.925z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-linkedin-blank" viewBox="0 0 32 32">
         <title>linkedin-blank</title>
         <path d="M29 0h-26c-1.65 0-3 1.35-3 3v26c0 1.65 1.35 3 3 3h26c1.65 0 3-1.35 3-3v-26c0-1.65-1.35-3-3-3zM12 26h-4v-14h4v14zM10 10c-1.106 0-2-0.894-2-2s0.894-2 2-2c1.106 0 2 0.894 2 2s-0.894 2-2 2zM26 26h-4v-8c0-1.106-0.894-2-2-2s-2 0.894-2 2v8h-4v-14h4v2.481c0.825-1.131 2.087-2.481 3.5-2.481 2.488 0 4.5 2.238 4.5 5v9z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-pinterest-blank" viewBox="0 0 32 32">
         <title>pinterest</title>
         <path d="M16 2.138c-7.656 0-13.863 6.206-13.863 13.863 0 5.875 3.656 10.887 8.813 12.906-0.119-1.094-0.231-2.781 0.050-3.975 0.25-1.081 1.625-6.887 1.625-6.887s-0.412-0.831-0.412-2.056c0-1.925 1.119-3.369 2.506-3.369 1.181 0 1.756 0.887 1.756 1.95 0 1.188-0.756 2.969-1.15 4.613-0.331 1.381 0.688 2.506 2.050 2.506 2.462 0 4.356-2.6 4.356-6.35 0-3.319-2.387-5.638-5.787-5.638-3.944 0-6.256 2.956-6.256 6.019 0 1.194 0.456 2.469 1.031 3.163 0.113 0.137 0.131 0.256 0.094 0.4-0.106 0.438-0.338 1.381-0.387 1.575-0.063 0.256-0.2 0.306-0.463 0.188-1.731-0.806-2.813-3.337-2.813-5.369 0-4.375 3.175-8.387 9.156-8.387 4.806 0 8.544 3.425 8.544 8.006 0 4.775-3.012 8.625-7.194 8.625-1.406 0-2.725-0.731-3.175-1.594 0 0-0.694 2.644-0.863 3.294-0.313 1.206-1.156 2.712-1.725 3.631 1.3 0.4 2.675 0.619 4.106 0.619 7.656 0 13.863-6.206 13.863-13.863 0-7.662-6.206-13.869-13.863-13.869z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-youtube-blank" viewBox="0 0 32 32">
         <title>youtube</title>
         <path d="M31.681 9.6c0 0-0.313-2.206-1.275-3.175-1.219-1.275-2.581-1.281-3.206-1.356-4.475-0.325-11.194-0.325-11.194-0.325h-0.012c0 0-6.719 0-11.194 0.325-0.625 0.075-1.987 0.081-3.206 1.356-0.963 0.969-1.269 3.175-1.269 3.175s-0.319 2.588-0.319 5.181v2.425c0 2.587 0.319 5.181 0.319 5.181s0.313 2.206 1.269 3.175c1.219 1.275 2.819 1.231 3.531 1.369 2.563 0.244 10.881 0.319 10.881 0.319s6.725-0.012 11.2-0.331c0.625-0.075 1.988-0.081 3.206-1.356 0.962-0.969 1.275-3.175 1.275-3.175s0.319-2.587 0.319-5.181v-2.425c-0.006-2.588-0.325-5.181-0.325-5.181zM12.694 20.15v-8.994l8.644 4.513-8.644 4.481z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-twitter-blank" viewBox="0 0 32 32">
         <title>twitter</title>
         <path d="M32 7.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path>
      </symbol>
      <symbol id="oxy-social-icons-icon-instagram-blank" viewBox="0 0 32 32">
         <title>instagram</title>
         <path d="M16 2.881c4.275 0 4.781 0.019 6.462 0.094 1.563 0.069 2.406 0.331 2.969 0.55 0.744 0.288 1.281 0.638 1.837 1.194 0.563 0.563 0.906 1.094 1.2 1.838 0.219 0.563 0.481 1.412 0.55 2.969 0.075 1.688 0.094 2.194 0.094 6.463s-0.019 4.781-0.094 6.463c-0.069 1.563-0.331 2.406-0.55 2.969-0.288 0.744-0.637 1.281-1.194 1.837-0.563 0.563-1.094 0.906-1.837 1.2-0.563 0.219-1.413 0.481-2.969 0.55-1.688 0.075-2.194 0.094-6.463 0.094s-4.781-0.019-6.463-0.094c-1.563-0.069-2.406-0.331-2.969-0.55-0.744-0.288-1.281-0.637-1.838-1.194-0.563-0.563-0.906-1.094-1.2-1.837-0.219-0.563-0.481-1.413-0.55-2.969-0.075-1.688-0.094-2.194-0.094-6.463s0.019-4.781 0.094-6.463c0.069-1.563 0.331-2.406 0.55-2.969 0.288-0.744 0.638-1.281 1.194-1.838 0.563-0.563 1.094-0.906 1.838-1.2 0.563-0.219 1.412-0.481 2.969-0.55 1.681-0.075 2.188-0.094 6.463-0.094zM16 0c-4.344 0-4.887 0.019-6.594 0.094-1.7 0.075-2.869 0.35-3.881 0.744-1.056 0.412-1.95 0.956-2.837 1.85-0.894 0.888-1.438 1.781-1.85 2.831-0.394 1.019-0.669 2.181-0.744 3.881-0.075 1.713-0.094 2.256-0.094 6.6s0.019 4.887 0.094 6.594c0.075 1.7 0.35 2.869 0.744 3.881 0.413 1.056 0.956 1.95 1.85 2.837 0.887 0.887 1.781 1.438 2.831 1.844 1.019 0.394 2.181 0.669 3.881 0.744 1.706 0.075 2.25 0.094 6.594 0.094s4.888-0.019 6.594-0.094c1.7-0.075 2.869-0.35 3.881-0.744 1.050-0.406 1.944-0.956 2.831-1.844s1.438-1.781 1.844-2.831c0.394-1.019 0.669-2.181 0.744-3.881 0.075-1.706 0.094-2.25 0.094-6.594s-0.019-4.887-0.094-6.594c-0.075-1.7-0.35-2.869-0.744-3.881-0.394-1.063-0.938-1.956-1.831-2.844-0.887-0.887-1.781-1.438-2.831-1.844-1.019-0.394-2.181-0.669-3.881-0.744-1.712-0.081-2.256-0.1-6.6-0.1v0z"></path>
         <path d="M16 7.781c-4.537 0-8.219 3.681-8.219 8.219s3.681 8.219 8.219 8.219 8.219-3.681 8.219-8.219c0-4.537-3.681-8.219-8.219-8.219zM16 21.331c-2.944 0-5.331-2.387-5.331-5.331s2.387-5.331 5.331-5.331c2.944 0 5.331 2.387 5.331 5.331s-2.387 5.331-5.331 5.331z"></path>
         <path d="M26.462 7.456c0 1.060-0.859 1.919-1.919 1.919s-1.919-0.859-1.919-1.919c0-1.060 0.859-1.919 1.919-1.919s1.919 0.859 1.919 1.919z"></path>
      </symbol>
   </defs>
</svg>
</div></body></html>